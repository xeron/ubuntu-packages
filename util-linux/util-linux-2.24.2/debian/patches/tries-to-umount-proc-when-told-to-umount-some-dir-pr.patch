From: Francesco Del Degan <f.deldegan@pr0gg3d.net>
Date: Thu, 17 May 2012 11:59:17 -0600
Subject: tries to umount /proc when told to umount /some/dir/proc without an
 /etc/mtab entry

Addresses-Debian-Bug: #634107
Signed-off-by: LaMont Jones <lamont@debian.org>
---
 mount-deprecated/fstab.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/mount-deprecated/fstab.c b/mount-deprecated/fstab.c
index 176a16b..0d557f9 100644
--- a/mount-deprecated/fstab.c
+++ b/mount-deprecated/fstab.c
@@ -273,9 +273,11 @@ getmntdevbackward (const char *name, struct mntentchn *mcprev) {
 			return mc;
 	}
 
-	/* non-canonical names in mtab (this is BAD THING!) */
+	/* non-canonical names in mtab (this is BAD THING!) 
+	 * but it should be allowed only for spec fsname(s) 
+	 */
 	for (mc = mcprev->prev; mc && mc != mc0; mc = mc->prev) {
-		char *cn = canonicalize(mc->m.mnt_fsname);
+		char *cn = canonicalize_spec(mc->m.mnt_fsname);
 		int res = cn ? streq(cn, name) : 0;
 
 		free(cn);
