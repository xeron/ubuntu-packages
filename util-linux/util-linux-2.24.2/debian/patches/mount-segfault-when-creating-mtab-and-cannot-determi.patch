From: LaMont Jones <lamont@debian.org>
Date: Fri, 13 Feb 2009 11:59:53 -0700
Subject: mount: segfault when creating mtab and cannot determine fsname

Addresses-Debian-Bug: 488312
Signed-off-by: LaMont Jones <lamont@debian.org>
---
 mount-deprecated/mount.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/mount-deprecated/mount.c b/mount-deprecated/mount.c
index d8e1712..ca42bf3 100644
--- a/mount-deprecated/mount.c
+++ b/mount-deprecated/mount.c
@@ -692,7 +692,7 @@ create_mtab (void) {
 		mnt.mnt_freq = mnt.mnt_passno = 0;
 		free(extra_opts);
 
-		if (my_addmntent (mfp, &mnt) == 1) {
+		if (mnt.mnt_fsname && my_addmntent (mfp, &mnt) == 1) {
 			int errsv = errno;
 			die (EX_FILEIO, _("mount: error writing %s: %s"),
 			     _PATH_MOUNTED, strerror (errsv));
